/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Main.java to edit this template
 */
package teatromoro;

import java.io.IOException;
import java.util.Scanner;
import java.util.Arrays;
import java.util.ArrayList;
/**
 *
 * @author bnunezd
 */
public class EFT_S9_Benjamin_Nuñez {

// Variables
    static double totalRecaudado = 0;
    static int totalEntradasVendidas = 0;
    static String[] asientos = new String[11]; 
    static double precio;
    static double[] precioFinal = new double[10];
    static int genero;
    static boolean bo1 = true;
    static boolean bo2 = true;
    static String nombreCliente;
    static boolean descuentoEstudiante = false;
    static boolean descuentoEdad = false;
    static boolean descuentoMujeres = false;
    static boolean descuentoNinos = false;
    static double porcentajeEstudiantes = 15;
    static double porcentajeEdad = 25;
    static double porcentajeMujeres = 20;
    static double porcentajeNinos = 10;
    static double porcentajeFinal = 0;
    static double porcentajeCalculo = 0;

    // ArrayList para almacenar las opciones del cliente;
    static ArrayList<String> nombreClientes = new ArrayList<>();
    static ArrayList<String> sectoresClientes = new ArrayList<>();
    static ArrayList<Integer> asientosClientes = new ArrayList<>();

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) throws InterruptedException, IOException {
        Scanner scan = new Scanner(System.in);

// Variables
        boolean bo = true; // boolean para validaciones
        int menuPrincipal; // elección menu principal

        // asientos disponibles
        asientos[0] = "ESCENARIO";
        asientos[1] = "1";
        asientos[2] = "2";
        asientos[3] = "3";
        asientos[4] = "4";
        asientos[5] = "5";
        asientos[6] = "6";
        asientos[7] = "7";
        asientos[8] = "8";
        asientos[9] = "9";
        asientos[10] = "10";

// Portada
        do {
            System.out.println("-------------Bienvenido al  Teatro Moro----------------------");
            System.out.println("=============================================================");
            System.out.println("-------------------Menu principal ---------------------------");
            System.out.println("1. Reservar entrada");
            System.out.println("2. Modificar reserva realizada para eliminar entrada/as");
            System.out.println("3. Revisar promociones disponibles");
            System.out.println("4. Salir del sistema");
            System.out.println("=============================================================");
            System.out.println("Ingresa alguna de las opciones para continuar");

            while (true) {
                if (!bo) {
                    System.out.println("No admitido - Debes ingresar alguna de las opciones indicadas");
                }
                if (scan.hasNextInt());
                {
                    menuPrincipal = scan.nextInt();
                    if (menuPrincipal == 1 || menuPrincipal == 2 || menuPrincipal == 3 || menuPrincipal == 4) {
                        break;
                    }
                }
                bo = false;
            }
            scan.nextLine();

            switch (menuPrincipal) {
                case 1 ->
                    reservaEntrada(); // clase 1

                case 2 ->
                    modificarReserva(); // clase 2

                case 3 ->
                    promociones();  // clase 3
                case 4 ->
                    terminarVenta();  // clase 3
            }
        } while (menuPrincipal == 1 || menuPrincipal == 2 || menuPrincipal == 3);
    }

    static void promociones() {
        System.out.println("Las promociones disponibles actualmente son: 10% de descuento a estudiantes y 15% de descuento a adultos mayores mayores de 65 añios");
        System.out.println(" -> 10% de descuento a niños");
        System.out.println(" -> 15% de descuento a estudiantes");
        System.out.println(" -> 20% de descuento a mujeres");
        System.out.println(" -> 25% de descuento a adultos mayores mayores de 65 añios");
        System.out.println("\n");

        
    }

    static void modificarReserva() {
        Scanner scan = new Scanner(System.in);
        // eliminar entradas ya reservadas 
        System.out.println("Ingrese numero de entrada a eliminar");
        int entradaEliminar = scan.nextInt();
        scan.nextLine();
        if (entradaEliminar >= 1 && entradaEliminar <= 10) {
            totalRecaudado -= precioFinal[entradaEliminar - 1];

            for (int i = entradaEliminar - 1; i < totalEntradasVendidas - 1; i++) {
                asientos[i] = asientos[i - 1];
                precioFinal[i] = precioFinal[i + 1];
            }
            totalEntradasVendidas--;
            System.out.println("Asiento eliminado correctamente");
        } else {
            System.out.println("Asiento no encontrado");
        }

    }

    static void terminarVenta() {
        System.out.println(" --- BOLETA DE COMPRA ---");
        System.out.println("TOTAL A PAGAR " + totalRecaudado);
        System.out.println("CANTIDAD ENTRADAS COMPRADAS " + totalEntradasVendidas);
        System.out.println("GRACIAS POR PREFERIR TEATRO MORO");
    }

    static void reservaEntrada() throws InterruptedException, IOException {
// Variables de Instancia
        Scanner scan = new Scanner(System.in);
        int numeroAsiento;
        String sector;
        int edad;
        bo1 = true;
        bo2 = true;
        descuentoEstudiante = false;
        descuentoEdad = false;

        System.out.println("\n");
        System.out.println("VIP         (1-3)   $30.000");
        System.out.println("PLATEA ALTA (4-5)   $18.000");
        System.out.println("PLATEA BAJA (6-7)   $15.000");
        System.out.println("PALCOS      (8-10)  $13.000");
        System.out.println("Asientos disponibles");
        System.out.println(Arrays.toString(asientos));
        System.out.println("Por favor, ingrese el numero de asiento, del 1 al 10");

        while (true) {
            if (!bo1) {
                System.out.println("Por favor, ingrese un numero de asiento valido y que este disponible");
            }
            if (scan.hasNextInt()) {
                numeroAsiento = scan.nextInt();
                scan.nextLine();
                // validar que el numero corresponde a un asiento
                if (!"---".equals(asientos[numeroAsiento]) && numeroAsiento >= 1 && numeroAsiento <= 10) {
                    System.out.println("Asiento disponible");
                    System.out.println("\n");
                   
                    System.out.println("Ingresa tu genero: Mujer (1) Hombre (2)");
                    while (true) {
                        if (!bo2) {
                            System.out.println("Por favor, ingrese una opcion valida");
                        }
                        if (scan.hasNextInt()) {
                            genero = scan.nextInt();
                            scan.nextLine();
                            System.out.println("\n");
                            if (genero == 1) {
                                System.out.println("Tienes un " + porcentajeMujeres + "% de descuento por ser mujer");
                                descuentoMujeres = true;
                                break;
                            } else if (genero == 2) {
                                System.out.println("No tienes descuento por genero");
                                break;
                            }
                        }
                        bo2 = false;
                    }
 
                    System.out.println("Ingresa tu edad");
                    while (true) {
                        if (!bo2) {
                            System.out.println("Por favor, ingrese un numero válido para tu edad");
                        }
                        if (scan.hasNextInt()) {
                            edad = scan.nextInt();
                            scan.nextLine();
                            System.out.println("\n");
                            if (edad >= 18 && edad <= 25) {
                                System.out.println("Tienes un " + porcentajeEstudiantes + "% de descuento por ser estudiante");
                                descuentoEstudiante = true;
                                break;
 
                            } else if (edad >= 1 && edad <= 17) {
                                System.out.println("Tienes un " + porcentajeNinos + "% de descuento por ser niño");
                                descuentoNinos = true;
                                break;
 
                            } else if (edad >= 65 && edad <= 105) {
                                System.out.println("Tienes un " + porcentajeEdad + "% de descuento por pertenecer a la tercera edad");
                                descuentoEdad = true;
                                break;
                            } else if (edad >= 1 && edad <= 105) {
                                System.out.println("Edad ingresada es valida");
                                break;
                            }
                        }
                        bo2 = false;
                    }
                    break;
                }
            }
            bo1 = false;
        }

        // datos del cliente
        System.out.println("---------- DATOS DEL CLIENTE ---------");
        System.out.println("Por favor, ingrese nombre de cliente para entrada");
        nombreCliente = scan.nextLine();

        // sector
        sector = "";
        if (numeroAsiento == 1 || numeroAsiento == 2 || numeroAsiento == 3) {
            sector = "VIP";
        } else if (numeroAsiento == 4 || numeroAsiento == 5) {
            sector = "PLATEA ALTA";
        } else if (numeroAsiento == 6 || numeroAsiento == 7) {
            sector = "PLATEA BAJA";
        } else if (numeroAsiento == 8 || numeroAsiento == 9 || numeroAsiento == 10) {
            sector = "PALCOS";
        }

       
        // Aplicar descuento según selecciones
        
        if(descuentoMujeres == true && descuentoNinos == true || descuentoEdad == true || descuentoEstudiante == true){
            if(Double.compare(porcentajeMujeres, porcentajeNinos) == 0){
                porcentajeFinal = porcentajeMujeres;
            } else if (Double.compare(porcentajeMujeres,porcentajeEdad) == 0){
                porcentajeFinal = porcentajeMujeres;
            } else if(Double.compare(porcentajeMujeres,porcentajeEstudiantes) == 0){
                porcentajeFinal = porcentajeMujeres;
            }
            if(descuentoNinos == true){
                porcentajeCalculo = porcentajeNinos;
            } else if (descuentoEdad == true){
                porcentajeCalculo = porcentajeEdad;
            } else if (descuentoEstudiante == true){
                porcentajeCalculo = porcentajeEstudiantes;
            }
            porcentajeFinal = Math.max(porcentajeMujeres,porcentajeCalculo);
        }
        // precio con mujer
        if ("VIP".equals(sector) && descuentoMujeres == true) {
            precio = 30000 - ((porcentajeMujeres / 100) * 30000);
        } else if ("PLATEA ALTA".equals(sector) && descuentoMujeres == true) {
            precio = 18000 - ((porcentajeMujeres / 100) * 30000);
        } else if ("PLATEA BAJA".equals(sector) && descuentoMujeres == true) {
            precio = 15000 - ((porcentajeMujeres / 100) * 30000);
        } else if ("PALCOS".equals(sector) && descuentoMujeres == true) {
            precio = 13000 - ((porcentajeMujeres / 100) * 30000);
        }
        // precio con mujer + otro descuento
        if ("VIP".equals(sector) && descuentoMujeres == true) {
            precio = 30000 - ((porcentajeFinal / 100) * 30000);
        } else if ("PLATEA ALTA".equals(sector) && descuentoMujeres == true) {
            precio = 18000 - ((porcentajeFinal / 100) * 30000);
        } else if ("PLATEA BAJA".equals(sector) && descuentoMujeres == true) {
            precio = 15000 - ((porcentajeFinal / 100) * 30000);
        } else if ("PALCOS".equals(sector) && descuentoMujeres == true) {
            precio = 13000 - ((porcentajeFinal / 100) * 30000);
        }
        
        // determinar si tiene algún descuento
        if ("VIP".equals(sector) && descuentoEstudiante == true && descuentoMujeres == false) {
            precio = 30000 - ((porcentajeEstudiantes / 100) * 30000);
        } else if ("PLATEA ALTA".equals(sector) && descuentoEstudiante == true && descuentoMujeres == false) {
            precio = 18000 - ((porcentajeEstudiantes / 100) * 30000);
        } else if ("PLATEA BAJA".equals(sector) && descuentoEstudiante == true && descuentoMujeres == false) {
            precio = 15000 - ((porcentajeEstudiantes / 100) * 30000);
        } else if ("PALCOS".equals(sector) && descuentoEstudiante == true && descuentoMujeres == false) {
            precio = 13000 - ((porcentajeEstudiantes / 100) * 30000);
 
        } else if ("VIP".equals(sector) && descuentoEdad == true && descuentoMujeres == false) {
            precio = 30000 - ((porcentajeEdad / 100) * 30000);
        } else if ("PLATEA ALTA".equals(sector) && descuentoEdad == true && descuentoMujeres == false) {
            precio = 18000 - ((porcentajeEdad / 100) * 30000);
        } else if ("PLATEA BAJA".equals(sector) && descuentoEdad == true && descuentoMujeres == false) {
            precio = 15000 - ((porcentajeEdad / 100) * 30000);
        } else if ("PALCOS".equals(sector) && descuentoEdad == true && descuentoMujeres == false) {
            precio = 13000 - ((porcentajeEdad / 100) * 30000);
 
        } else if ("VIP".equals(sector) && descuentoNinos == true && descuentoMujeres == false) {
            precio = 30000 - ((porcentajeNinos / 100) * 30000);
        } else if ("PLATEA ALTA".equals(sector) && descuentoNinos == true && descuentoMujeres == false) {
            precio = 18000 - ((porcentajeNinos / 100) * 30000);
        } else if ("PLATEA BAJA".equals(sector) && descuentoNinos == true && descuentoMujeres == false) {
            precio = 15000 - ((porcentajeNinos / 100) * 30000);
        } else if ("PALCOS".equals(sector) && descuentoNinos == true && descuentoMujeres == false) {
            precio = 13000 - ((porcentajeNinos / 100) * 30000);
        }
        
        // precio sin ningun descuento aplicado
        if ("VIP".equals(sector) && descuentoEstudiante == false && descuentoNinos == false && descuentoMujeres == false && descuentoEdad == false) {
            precio = 30000;
        } else if ("PLATEA ALTA".equals(sector) && descuentoEstudiante == false && descuentoNinos == false && descuentoMujeres == false && descuentoEdad == false) {
            precio = 18000;
        } else if ("PLATEA BAJA".equals(sector) && descuentoEstudiante == false && descuentoNinos == false && descuentoMujeres == false && descuentoEdad == false) {
            precio = 15000;
        } else if ("PALCOS".equals(sector) && descuentoEstudiante == false && descuentoNinos == false && descuentoMujeres == false && descuentoEdad == false) {
            precio = 13000;
        }
        
        long inicio = System.currentTimeMillis();
        int opcion = 0;
        boolean ingresoAntesDeTiempo = false;
        final int tiempoLimite = 60;
        
        //Confirmación
        System.out.println("Reserva ingresada");
        System.out.println("Reserva ingresada");
        System.out.println("El asiento elegido es " + numeroAsiento);
        System.out.println("Para confirmar su reserva ingresa 1 y enter, tienes un tiempo limite de " + tiempoLimite + " segundos");

        while ((System.currentTimeMillis()
                - inicio) < tiempoLimite * 1000) {
            if (System.in.available() > 0) {
                opcion = scan.nextInt();
                ingresoAntesDeTiempo = true;
                break;
            }
            Thread.sleep(100);
        }

        if (!ingresoAntesDeTiempo) {
            System.out.println("Tiempo agotado. La operación fue cancelada automáticamente.");
        } else if (opcion
                == 1) {
            
            //Generar Boleta
            System.out.println("\n");
            System.out.println("Entrada reservada con exito");
            
            System.out.println("|========================= TICKET DETALLE ENTRADA =========================|");
            System.out.println("| Nombre Cliente: " + nombreCliente);
            System.out.println("| Valor Sector: " + precio);
            System.out.println("| N° Asiento: " + numeroAsiento);
            System.out.println("| Sector: " + sector + "\n");
            System.out.println("|========================= ENTRADA NO TRSFERIBLE ==========================|");

            // Guardar información de entrada reservada y comprada
            asientos[numeroAsiento] = "---";
            totalEntradasVendidas++;
            totalRecaudado += precio;
            precioFinal[totalEntradasVendidas] = precio;

            // Guardar información sobre el cliente: nombre, sector y numero de asiento elegido
            nombreClientes.add(nombreCliente);
            sectoresClientes.add(sector);
            asientosClientes.add(numeroAsiento);
        }
    }
}
